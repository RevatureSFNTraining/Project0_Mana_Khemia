var urlParse=require("url").parse,ClientConstants=require("./protocol/constants/client"),Charsets=require("./protocol/constants/charsets"),SSLProfiles=null;function ConnectionConfig(t){"string"==typeof t&&(t=ConnectionConfig.parseUrl(t)),this.host=t.host||"localhost",this.port=t.port||3306,this.localAddress=t.localAddress,this.socketPath=t.socketPath,this.user=t.user||void 0,this.password=t.password||void 0,this.database=t.database,this.connectTimeout=void 0===t.connectTimeout?1e4:t.connectTimeout,this.insecureAuth=t.insecureAuth||!1,this.supportBigNumbers=t.supportBigNumbers||!1,this.bigNumberStrings=t.bigNumberStrings||!1,this.dateStrings=t.dateStrings||!1,this.debug=t.debug,this.trace=!1!==t.trace,this.stringifyObjects=t.stringifyObjects||!1,this.timezone=t.timezone||"local",this.flags=t.flags||"",this.queryFormat=t.queryFormat,this.pool=t.pool||void 0,this.ssl="string"==typeof t.ssl?ConnectionConfig.getSSLProfile(t.ssl):t.ssl||!1,this.localInfile=void 0===t.localInfile||t.localInfile,this.multipleStatements=t.multipleStatements||!1,this.typeCast=void 0===t.typeCast||t.typeCast," "===this.timezone[0]&&(this.timezone="+"+this.timezone.substr(1)),this.ssl&&(this.ssl.rejectUnauthorized=!1!==this.ssl.rejectUnauthorized),this.maxPacketSize=0,this.charsetNumber=t.charset?ConnectionConfig.getCharsetNumber(t.charset):t.charsetNumber||Charsets.UTF8_GENERAL_CI;var e=ConnectionConfig.getDefaultFlags(t);this.clientFlags=ConnectionConfig.mergeFlags(e,t.flags)}module.exports=ConnectionConfig,ConnectionConfig.mergeFlags=function(t,e){var s=ConnectionConfig.parseFlagList(t),i=ConnectionConfig.parseFlagList(e);for(var r in i)!1!==s[r]&&(s[r]=i[r]);var o=0;for(var r in s)s[r]&&(o|=ClientConstants["CLIENT_"+r]||0);return o},ConnectionConfig.getCharsetNumber=function(t){var e=Charsets[t.toUpperCase()];if(void 0===e)throw new TypeError("Unknown charset '"+t+"'");return e},ConnectionConfig.getDefaultFlags=function(t){var e=["-COMPRESS","-CONNECT_ATTRS","+CONNECT_WITH_DB","+FOUND_ROWS","+IGNORE_SIGPIPE","+IGNORE_SPACE","+LOCAL_FILES","+LONG_FLAG","+LONG_PASSWORD","+MULTI_RESULTS","+ODBC","-PLUGIN_AUTH","+PROTOCOL_41","+PS_MULTI_RESULTS","+RESERVED","+SECURE_CONNECTION","+TRANSACTIONS"];return t&&void 0!==t.localInfile&&!t.localInfile&&e.push("-LOCAL_FILES"),t&&t.multipleStatements&&e.push("+MULTI_STATEMENTS"),e},ConnectionConfig.getSSLProfile=function(t){SSLProfiles||(SSLProfiles=require("./protocol/constants/ssl_profiles"));var e=SSLProfiles[t];if(void 0===e)throw new TypeError("Unknown SSL profile '"+t+"'");return e},ConnectionConfig.parseFlagList=function(t){var e=Object.create(null);if(!t)return e;for(var s=Array.isArray(t)?t:String(t||"").toUpperCase().split(/\s*,+\s*/),i=0;i<s.length;i++){var r=s[i],o=1,n=r[0];void 0!==n&&("-"!==n&&"+"!==n&&(o=0,n="+"),e[r.substr(o)]="+"===n)}return e},ConnectionConfig.parseUrl=function(t){var e={host:(t=urlParse(t,!0)).hostname,port:t.port,database:t.pathname.substr(1)};if(t.auth){var s=t.auth.split(":");e.user=s.shift(),e.password=s.join(":")}if(t.query)for(var i in t.query){var r=t.query[i];try{e[i]=JSON.parse(r)}catch(t){e[i]=r}}return e};