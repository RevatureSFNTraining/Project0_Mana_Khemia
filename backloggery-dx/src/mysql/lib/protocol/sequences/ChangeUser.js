var Sequence=require("./Sequence"),Util=require("util"),Packets=require("../packets"),Auth=require("../Auth");function ChangeUser(e,t){Sequence.call(this,e,t),this._user=e.user,this._password=e.password,this._database=e.database,this._charsetNumber=e.charsetNumber,this._currentConfig=e.currentConfig}module.exports=ChangeUser,Util.inherits(ChangeUser,Sequence),ChangeUser.prototype.determinePacket=function(e){switch(e){case 254:return Packets.AuthSwitchRequestPacket;case 255:return Packets.ErrorPacket;default:return}},ChangeUser.prototype.start=function(e){var t=e.scrambleBuff();t=Auth.token(this._password,t);var r=new Packets.ComChangeUserPacket({user:this._user,scrambleBuff:t,database:this._database,charsetNumber:this._charsetNumber});this._currentConfig.user=this._user,this._currentConfig.password=this._password,this._currentConfig.database=this._database,this._currentConfig.charsetNumber=this._charsetNumber,this.emit("packet",r)},ChangeUser.prototype.AuthSwitchRequestPacket=function(e){var t=e.authMethodName,r=Auth.auth(t,e.authMethodData,{password:this._password});if(void 0!==r)this.emit("packet",new Packets.AuthSwitchResponsePacket({data:r}));else{var s=new Error("MySQL is requesting the "+t+" authentication method, which is not supported.");s.code="UNSUPPORTED_AUTH_METHOD",s.fatal=!0,this.end(s)}},ChangeUser.prototype.ErrorPacket=function(e){var t=this._packetToError(e);t.fatal=!0,this.end(t)};