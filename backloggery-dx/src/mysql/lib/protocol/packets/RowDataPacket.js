var Types=require("../constants/types"),Charsets=require("../constants/charsets"),Field=require("./Field"),IEEE_754_BINARY_64_PRECISION=Math.pow(2,53);function RowDataPacket(){}function parse(e,t,s,r,a){for(var n=this,p=function(){return n._typeCast(o,e,a.config.timezone,a.config.supportBigNumbers,a.config.bigNumberStrings,a.config.dateStrings)},i=0;i<t.length;i++){var c,o=t[i];c="function"==typeof s?s.apply(a,[new Field({packet:o,parser:e}),p]):s?this._typeCast(o,e,a.config.timezone,a.config.supportBigNumbers,a.config.bigNumberStrings,a.config.dateStrings):o.charsetNr===Charsets.BINARY?e.parseLengthCodedBuffer():e.parseLengthCodedString(),"string"==typeof r&&r.length?this[o.table+r+o.name]=c:r?(this[o.table]=this[o.table]||{},this[o.table][o.name]=c):this[o.name]=c}}function typeCast(e,t,s,r,a,n){var p;switch(e.type){case Types.TIMESTAMP:case Types.TIMESTAMP2:case Types.DATE:case Types.DATETIME:case Types.DATETIME2:case Types.NEWDATE:var i=t.parseLengthCodedString();if(typeMatch(e.type,n))return i;if(null===i)return null;var c=i;e.type===Types.DATE&&(i+=" 00:00:00"),"local"!==s&&(i+=" "+s);var o=new Date(i);return isNaN(o.getTime())?c:o;case Types.TINY:case Types.SHORT:case Types.LONG:case Types.INT24:case Types.YEAR:case Types.FLOAT:case Types.DOUBLE:return null===(p=t.parseLengthCodedString())||e.zeroFill&&"0"===p[0]?p:Number(p);case Types.NEWDECIMAL:case Types.LONGLONG:return null===(p=t.parseLengthCodedString())||e.zeroFill&&"0"===p[0]||r&&(a||Number(p)>=IEEE_754_BINARY_64_PRECISION||Number(p)<=-IEEE_754_BINARY_64_PRECISION)?p:Number(p);case Types.BIT:return t.parseLengthCodedBuffer();case Types.STRING:case Types.VAR_STRING:case Types.TINY_BLOB:case Types.MEDIUM_BLOB:case Types.LONG_BLOB:case Types.BLOB:return e.charsetNr===Charsets.BINARY?t.parseLengthCodedBuffer():t.parseLengthCodedString();case Types.GEOMETRY:return t.parseGeometryValue();default:return t.parseLengthCodedString()}}function typeMatch(e,t){return Array.isArray(t)?-1!==t.indexOf(Types[e]):Boolean(t)}module.exports=RowDataPacket,Object.defineProperty(RowDataPacket.prototype,"parse",{configurable:!0,enumerable:!1,value:parse}),Object.defineProperty(RowDataPacket.prototype,"_typeCast",{configurable:!0,enumerable:!1,value:typeCast});